# Reproducible Research: Peer Assessment 1


## Loading and preprocessing the data

The first step is to load the data. These are already present in the forked repository so I don't need to download them again. However, they are originally zipped, so I unzip them if this has not already been done. The result is a text file in CSV format named *`activity.csv`*.

To read the unzipped data, I use the `read.csv()` function where I precise the classes of the three columns corresponding to the number of steps (integer class), the date (Date class), and the 5-minute identifier (integer class).
```{r cache=TRUE}
if(!file.exists('activity.csv')){
       unzip('activity.zip')
}
data <- read.csv('activity.csv', colClasses = c('integer', 'Date', 'integer'))
```
Notice that I cache the output of the previous code chunk using `cache = TRUE` to avoid loading the data each time I knitr the Rmd file.

A structure of the data can be viewd using the `str()` function as follows.

```{r}
str(data)
```
The data frame `data` has 3 columns and 17568 observations as expected from the project description.


We can check that each day has 288 observations, corresponding to the 288 = 24x60/5 possible 5-minute intervals, using `table(data$date)`. We check as well that each 5-minute interval is present in the 61 days, from 2012-10-01 to 2012-11-30, using `table(data$interval)`. 

Notice that **the identifier for the 5-minute intervals has gaps at the end of each hour**. E.g.: the identifier jumps from 55 to 100. This correspond to times 00:55 and 01:00 respectively. Thus, the identifier runs from 0 to 2355 instead of from 0 to 1440 if it was a continuous label of 5-minute intervals (there are 1440 minutes a day ). **I will not convert this identifier to a time format.** This is justified by the x-axis of the time series plot showed as an exemple in the project description where we see clearely that the 5-minute identifier goes until about 2355.

The data up to this point need no additional processing or transformation for what follows. We will comment on the missing values `NA` later.

## What is mean total number of steps taken per day?

In order to calculate the total number of steps taken per day, I use the `aggregate()` function with the formula `steps ~ date` and the argument `FUN = sum`. Missing values are excluded by default in the `aggregate()` function call when a formula is used. Thus, days where there are at least one `NA` value are not considered here. 

The result is stored in a new data frame named `tsd` (**t**otal **s**teps per **d**ay) which has two columns: `date` for the date, and `steps` for the total number of steps per day. It has 53 rows, which means that 8 days have `NA` values for the number of steps.

```{r}
tsd <- aggregate(steps ~ date, data, FUN = sum)
str(tsd)
```

Then a histogram is plotted out of this new data frame with appropriate labeling of the axes and the plot.

```{r}
hist(tsd$steps, xlab='Number of steps', main='Total number of steps taken  per day', col = 'red')
```

I didn't specify a value for the argument `breaks` as I think the resulting histogram is fine. The next refinement for the histogram is obtained using `breaks = 8`.

The histogram seems relatively symmetric and the total number of steps per day follows a unimodal distribution. This is confirmed by calculating the mean and the median associated with the total number of steps per day as follows:
```{r}
mean(tsd$steps); median(tsd$steps)
```

These quantities are almost equal.

## What is the average daily activity pattern?

In order to study the average daily activity, we will make a time series plot of the average number of steps taken, averaged across all days, as a function of the 5-minute intervals.

I use the `aggregate()` function again with the formula `steps ~ interval` and the argument `FUN = mean`. This will calculate, for a given 5-minute intervall, the mean of the number of steps taken across all days. The result is stored in a new data frame named `asi` (**a**verage **d**aily **a**ctivity) which has two columns: `interval` for the 5-minute interval identifier, and `steps` for the mean number of steps across all days. It has naturally 288 rows.

```{r}
asi <- aggregate(steps ~ interval, data, FUN = mean)
plot(steps ~ interval, asi, type='l', ylab = 'Average number of steps', col = 'blue')
```
The average number of steps is almost zero until intervall 500, corresponding to time 05:00, and dies out approximately afer 2100, corresponding to a time 21:00.

It peaks at 
```{r}
max(asi$steps)
```
 steps in the morning for the 5-minute interval
```{r}
asi[asi$steps == max(asi$steps), 1]
```

which corresponds to a time 8:35. This seems to be the average time at which people leave home for their work. Its width extends to approximately 920, corresponding to a time 09:20 as can be seen from the ordering of `asi$steps` by decreasing average number of steps

```{r}
head(asi[order(asi$steps, decreasing = TRUE), 1], n=25)
```

It seems there is no other peak of the same intensity at the end of the day. This may hint to different times for the daily ending of work. Looking at the ordered `asi$steps`, it seems that 15:45 and 18:45 at the most common times for people leaving their work. Notice also the peak arround 12:10 which would correspond to lunch time.



## Imputing missing values

So far, we have not considered the missing values `NA`. In the following, we will devise a strategy to replace these missing values to include all date in the study.

The total number of missing values in the dataset can be obtained from

```{r}
sum(!complete.cases(data))
```
 and this is exactly the same number of `NA` in the column `steps`
```{r}
sum(is.na(data$steps))
```

In order to define a strategy to fill these missing values, we need first to understand their structure in each day. The question is: How many `NA` do we have in each day ?

To answer the question, I first create a logical vector `missing` using the `is.na()` function on `data$steps`, then I use again the `aggregate()` function with the formula `missing ~ date` and the argument `FUN = sum`. This results in a data frame named `na.sd` with two columns: `date` and `missing` for the number of missing value per day.

```{r}
missing <- is.na(data$steps)
na.sd <- aggregate(missing ~ date, data, sum)
head(na.sd)
```

For exemple, the date `2012-10-01` has 288 missing values, whereas the next day has none.

A table made out of all values of `missing` in `na.sd` yields
```{r}
table(na.sd$missing)
```

It turns out that each day has either all the steps values missing or none of them. There are exactly 8 days whose all steps are missing as can be checked by counting the number of `NA` values per day. 

There are indeed 53 days with no `NA` values and 8 days with 288 `NA` values for the number of steps, i.e `NA` values at each 5-minute interval.

Notice that we knew already that 8 days contain missing values for the number of steps from the fact that `tsd` had only 53 days while the total number of days is 61.

Given the fact above, a reasonable strategy is to fill the missing values of each 5-minute interval of those 8 days with the mean for that 5-minute interval obtained earlier. I create thus a new data frame named `datac` where I fill the days with missing values with the vector `asi$steps`. For this, I create vector `vec` which is an 8, as in the number of days with `NA`s, replication of the vector `asi$steps`.

```{r}
datac <- data
vec <- rep(asi$steps,8)
datac[missing,1] <- vec
```

Now, we can again calculate the total number of steps per day and plot the corresponding histogram
```{r}
tsdc <- aggregate(steps ~ date, datac, sum)
hist(tsdc$steps, , xlab='Number of steps', main='Total number of steps taken  per day', col = 'red')
```
This looks very similar to the previous histogram. The only difference is the frequency of the central bin, which went from 27 to 35. This corresponds to exactly 8 additions to the mean value of the total number of steps per day, which are located in the central bin as we've seen earlier.

The new mean and median are given by
```{r}
mean(tsdc$steps); median(tsdc$steps)
```

Now the `mean` and `median` are exactly the same. This is no surprise since we've been filling 8 days with the exact same values as the average day. 


## Are there differences in activity patterns between weekdays and weekends?

```{r}
library(lattice)
inweekends <- weekdays(datac$date) %in% c('Samedi', 'Dimanche')

weekday <- rep(0, length(datac))
weekday[inweekends] <- 'weekend'
weekday[!inweekends] <- 'weekday'
#weekday <- factor(weekday, levels=c('weekday', 'weekend'))
datac <- cbind(datac, weekday)
avg <- aggregate(steps ~ interval + weekday, datac, mean)
xyplot(steps ~ interval | weekday, avg, type='l', layout=c(1,2))
```

